<?xml version="1.0"?>
<project name="build.ant4eclipse"
         basedir=".."
         default="build.ant4eclipse"
         xmlns:ant4eclipse="antlib:org.ant4eclipse">

	<taskdef resource="org/tigris/subversion/svnant/svnantlib.xml" />

	<taskdef uri="antlib:org.ant4eclipse"
	         resource="org/ant4eclipse/antlib.xml" />

	<!-- define environment properties -->
	<property file="${basedir}\org.ant4eclipse.build\environment.properties" />

	<!-- define general properties -->
	<property name="build.compiler"
	          value="org.ant4eclipse.jdt.ecj.JDTCompilerAdapter" />
	<property name="destination"
	          value="${basedir}\org.ant4eclipse.build\destination" />
	<property name="teamprojectset"
	          value="${basedir}/org.ant4eclipse.build/projectSet-main.psf" />

	<!-- define your jdk location here -->
	<ant4eclipse:jreContainer>
		<jre id="jdk15" location="${jdk15.location}" />
		<jre id="jdk16" location="${jdk16.location}" />
	</ant4eclipse:jreContainer>

	<!-- ================================= 
          target: build.ant4eclipse              
         ================================= -->
	<target name="build.ant4eclipse" depends="export.ant4eclipse">

		<ant4eclipse:executeProjectSet workspace="${destination}"
		                               teamprojectset="${teamprojectset}"
		                               projectReferenceTypes="jdt">

			<ant4eclipse:forEachProject>

				<ant4eclipse:executeJdtProject workspace="${destination}"
				                               projectname="${executeProjectSet.project.name}">

					<ant4eclipse:forEachOutputDirectory>
						<echo>Scrubbing directory "${executeJdtProject.output.directory}"</echo>
						<delete dir="${executeJdtProject.output.directory}"
						        quiet="true" />
						<mkdir dir="${executeJdtProject.output.directory}" />
					</ant4eclipse:forEachOutputDirectory>


					<ant4eclipse:forAllSourceDirectories>
						<echo>Compiling jdt project '${executeJdtProject.project.name}'</echo>
						<echo>  - source directories -> ${executeJdtProject.source.directories}</echo>
						<echo>  - output directory   -> ${executeJdtProject.default.output.directory}</echo>
						<echo>  - bootclasspath      -> ${executeJdtProject.boot.classpath}</echo>
						<echo>  - classpath          -> ${executeJdtProject.classpath.absolute.compiletime}</echo>

						<javac destdir="${executeJdtProject.default.output.directory}"
						       debug="on"
						       source="1.5">

							<src refid="executeJdtProject.source.directories.path" />
							<bootclasspath refid="executeJdtProject.boot.classpath.path" />
							<classpath refid="executeJdtProject.classpath.absolute.compiletime.path" />

							<compilerarg value="compiler.args.refid=executeJdtProject.compiler.args"
							             compiler="org.ant4eclipse.jdt.ecj.JDTCompilerAdapter" />
						</javac>
					</ant4eclipse:forAllSourceDirectories>

					<ant4eclipse:forEachSourceDirectory>
						<echo>Copying resources from directory '${executeJdtProject.source.directory}'</echo>
						<copy todir="${executeJdtProject.output.directory}">
							<fileset dir="${executeJdtProject.source.directory}">
								<exclude name="**/*.java" />
							</fileset>
						</copy>
					</ant4eclipse:forEachSourceDirectory>

					<ant4eclipse:forEachOutputDirectory>
						<echo>Copying '${executeJdtProject.output.directory}'</echo>
						<copy toDir="${destination}/merged/classes">
							<fileset dir="${executeJdtProject.output.directory}">
								<include name="**/*.class" />
							</fileset>
						</copy>

						<copy toDir="${destination}/merged/cfg/${executeJdtProject.project.name}">
							<fileset dir="${executeJdtProject.output.directory}">
								<include name="**/*.xml" />
								<include name="**/*.properties" />
							</fileset>
						</copy>
					</ant4eclipse:forEachOutputDirectory>

				</ant4eclipse:executeJdtProject>

			</ant4eclipse:forEachProject>

		</ant4eclipse:executeProjectSet>

	</target>

	<!-- - - - - - - - - - - - - - - - - - 
          target: export.ant4eclipse                      
         - - - - - - - - - - - - - - - - - -->
	<target name="export.ant4eclipse" if="export.ant4eclipse">

		<echo>Export ant4eclipse from SVN...</echo>

		<delete dir="${destination}" quiet="true" />
		<mkdir dir="${destination}" />

		<ant4eclipse:svnGetProjectSet username="${svn.username}"
		                              password="${svn.password}"
		                              command="export"
		                              projectSet="${teamprojectset}"
		                              destination="${destination}" />
	</target>


</project>